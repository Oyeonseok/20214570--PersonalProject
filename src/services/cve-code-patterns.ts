export interface CveCodePattern {
  cveId: string;
  packageName: string;
  cweId: string;
  dangerousPatterns: RegExp[];
  description: string;
  descriptionKo: string;
  codeRemediation: string;
  codeRemediationKo: string;
  safeAlternative: string;
  references: string[];
}

const CVE_CODE_PATTERNS: CveCodePattern[] = [
  {
    cveId: 'CVE-2021-23337',
    packageName: 'lodash',
    cweId: 'CWE-77',
    dangerousPatterns: [
      /\b_\.template\s*\(\s*(?:req\.|input|user|data|body|query|params|payload|args)/i,
      /\blodash\.template\s*\(\s*(?:req\.|input|user|data|body|query|params)/i,
    ],
    description: 'lodash template() allows command injection when user input is passed as template string',
    descriptionKo: 'lodash template()에 사용자 입력을 직접 전달하면 명령 인젝션이 가능합니다',
    codeRemediation: 'Use a safe template engine (handlebars, ejs with escaping) or validate/sanitize input before passing to _.template(). Never pass raw user input.',
    codeRemediationKo: 'handlebars, ejs 등 안전한 템플릿 엔진을 사용하거나, _.template()에 전달하기 전에 입력을 검증/새니타이즈하세요. 사용자 입력을 직접 전달하지 마세요.',
    safeAlternative: `// Safe: Use handlebars instead
import Handlebars from 'handlebars';
const template = Handlebars.compile('<p>{{name}}</p>');
const html = template({ name: sanitizedInput });`,
    references: ['https://github.com/advisories/GHSA-35jh-r3h4-6jhm'],
  },
  {
    cveId: 'CVE-2020-8203',
    packageName: 'lodash',
    cweId: 'CWE-1321',
    dangerousPatterns: [
      /\b_\.(?:defaultsDeep|merge|mergeWith|set|setWith)\s*\([^,]*,\s*(?:req\.|input|user|data|body|query|params)/i,
      /\blodash\.(?:defaultsDeep|merge|set)\s*\([^,]*,\s*(?:req\.|input|user|data|body)/i,
    ],
    description: 'lodash merge/defaultsDeep allows prototype pollution via crafted user input',
    descriptionKo: 'lodash merge/defaultsDeep에 사용자 입력을 전달하면 프로토타입 오염이 가능합니다',
    codeRemediation: 'Validate input with schema (zod/joi), filter __proto__/constructor keys, or use Object.create(null) as merge target.',
    codeRemediationKo: 'zod/joi로 입력 스키마를 검증하고, __proto__/constructor 키를 필터링하거나, Object.create(null)을 병합 대상으로 사용하세요.',
    safeAlternative: `// Safe: Validate before merge
import { z } from 'zod';
const schema = z.object({ name: z.string(), age: z.number() });
const validated = schema.parse(req.body);
const result = _.merge({}, validated);`,
    references: ['https://github.com/advisories/GHSA-p6mc-m468-83gw'],
  },
  {
    cveId: 'CVE-2024-29041',
    packageName: 'express',
    cweId: 'CWE-601',
    dangerousPatterns: [
      /res\.redirect\s*\(\s*(?:req\.(?:query|params|body)\.|input|url|redirect|next|returnUrl|callback)/i,
    ],
    description: 'express res.redirect() is vulnerable to open redirect when user input is passed directly',
    descriptionKo: 'express res.redirect()에 사용자 입력을 직접 전달하면 오픈 리다이렉트 취약점이 발생합니다',
    codeRemediation: 'Validate redirect URLs against a whitelist of allowed domains. Only allow relative paths or same-origin URLs.',
    codeRemediationKo: '리다이렉트 URL을 허용된 도메인 화이트리스트로 검증하세요. 상대 경로 또는 동일 출처 URL만 허용하세요.',
    safeAlternative: `// Safe: Validate redirect target
const allowedPaths = ['/dashboard', '/profile', '/home'];
const target = req.query.redirect;
if (typeof target === 'string' && allowedPaths.includes(target)) {
  res.redirect(target);
} else {
  res.redirect('/');
}`,
    references: ['https://github.com/advisories/GHSA-rv95-896h-c2vc'],
  },
  {
    cveId: 'CVE-2023-45857',
    packageName: 'axios',
    cweId: 'CWE-352',
    dangerousPatterns: [
      /axios\.(get|post|put|delete|patch)\s*\([^)]*(?:withCredentials|xsrfCookieName)/i,
      /axios\.create\s*\(\s*\{[^}]*withCredentials\s*:\s*true/i,
    ],
    description: 'axios leaks XSRF-TOKEN cookie in cross-site requests when withCredentials is enabled',
    descriptionKo: 'axios에서 withCredentials 활성화 시 XSRF-TOKEN 쿠키가 크로스사이트 요청에 노출됩니다',
    codeRemediation: 'Upgrade axios to >=1.6.0. Set xsrfCookieName and xsrfHeaderName explicitly. Avoid withCredentials for cross-origin requests.',
    codeRemediationKo: 'axios를 1.6.0 이상으로 업그레이드하세요. xsrfCookieName/xsrfHeaderName을 명시적으로 설정하세요.',
    safeAlternative: `// Safe: Explicit CSRF config
const api = axios.create({
  baseURL: '/api',
  withCredentials: true,
  xsrfCookieName: 'XSRF-TOKEN',
  xsrfHeaderName: 'X-XSRF-TOKEN',
});`,
    references: ['https://github.com/advisories/GHSA-wf5p-g6vw-rhqq'],
  },
  {
    cveId: 'CVE-2022-23529',
    packageName: 'jsonwebtoken',
    cweId: 'CWE-20',
    dangerousPatterns: [
      /jwt\.verify\s*\(\s*\w+\s*,\s*(?:req\.|input|user|data|body|config\[|process\.env\.\w+\s*\|\|)/i,
    ],
    description: 'jsonwebtoken allows arbitrary code execution via crafted secretOrPublicKey parameter',
    descriptionKo: 'jsonwebtoken의 secretOrPublicKey 파라미터 검증이 미흡하여 임의 코드 실행이 가능합니다',
    codeRemediation: 'Upgrade to jsonwebtoken >=9.0.0. Always use a fixed string/Buffer for secret. Never derive secret from user input.',
    codeRemediationKo: 'jsonwebtoken 9.0.0 이상으로 업그레이드하세요. 비밀키는 고정된 문자열/Buffer를 사용하고, 사용자 입력에서 유도하지 마세요.',
    safeAlternative: `// Safe: Fixed secret with algorithm restriction
import jwt from 'jsonwebtoken';
const SECRET = process.env.JWT_SECRET!;
const decoded = jwt.verify(token, SECRET, { algorithms: ['HS256'] });`,
    references: ['https://github.com/advisories/GHSA-27h2-hvpr-p74q'],
  },
  {
    cveId: 'CVE-2022-3517',
    packageName: 'minimatch',
    cweId: 'CWE-1333',
    dangerousPatterns: [
      /\bnew\s+Minimatch\s*\(\s*(?:req\.|input|user|data|body|query|params|pattern)/i,
      /\bminimatch\s*\(\s*\w+\s*,\s*(?:req\.|input|user|data|body|query|params)/i,
    ],
    description: 'minimatch is vulnerable to ReDoS via specially crafted brace expansion patterns',
    descriptionKo: 'minimatch의 brace expansion에서 특수하게 제작된 패턴으로 ReDoS 공격이 가능합니다',
    codeRemediation: 'Upgrade to minimatch >=3.0.5. Limit input pattern length. Validate patterns before passing to minimatch.',
    codeRemediationKo: 'minimatch 3.0.5 이상으로 업그레이드하세요. 입력 패턴 길이를 제한하고, 전달 전 패턴을 검증하세요.',
    safeAlternative: `// Safe: Limit pattern length
if (pattern.length > 200) throw new Error('Pattern too long');
const result = minimatch(filename, pattern);`,
    references: ['https://github.com/advisories/GHSA-f8q6-p94x-37v3'],
  },
  {
    cveId: 'CVE-2022-24999',
    packageName: 'qs',
    cweId: 'CWE-1321',
    dangerousPatterns: [
      /\bqs\.parse\s*\(\s*(?:req\.|input|query|url|search|location)/i,
      /\bquerystring\.parse\s*\(\s*(?:req\.|input|query|url)/i,
    ],
    description: 'qs library prototype pollution via __proto__ key in parsed query strings',
    descriptionKo: 'qs 라이브러리에서 쿼리 문자열 파싱 시 __proto__ 키를 통한 프로토타입 오염이 가능합니다',
    codeRemediation: 'Upgrade qs >=6.10.3. Set depth and parameterLimit options. Use allowPrototypes: false (default).',
    codeRemediationKo: 'qs 6.10.3 이상으로 업그레이드하세요. depth와 parameterLimit 옵션을 설정하세요.',
    safeAlternative: `// Safe: Limit depth and parameters
import qs from 'qs';
const parsed = qs.parse(queryString, { depth: 5, parameterLimit: 100 });`,
    references: ['https://github.com/advisories/GHSA-hrpp-h998-j3pp'],
  },
  {
    cveId: 'CVE-2022-0235',
    packageName: 'node-fetch',
    cweId: 'CWE-601',
    dangerousPatterns: [
      /\bfetch\s*\(\s*(?:req\.|input|user|url|redirect|target|href)/i,
      /\bnode-fetch\s*\(\s*(?:req\.|input|user|url)/i,
    ],
    description: 'node-fetch exposes Authorization headers when following cross-origin redirects',
    descriptionKo: 'node-fetch에서 크로스 오리진 리다이렉트 시 Authorization 헤더가 노출됩니다',
    codeRemediation: 'Upgrade node-fetch >=2.6.7. Use redirect: "manual" and handle redirects explicitly. Strip sensitive headers on cross-origin redirects.',
    codeRemediationKo: 'node-fetch 2.6.7 이상으로 업그레이드하세요. redirect: "manual"을 사용하고, 크로스 오리진 리다이렉트 시 민감한 헤더를 제거하세요.',
    safeAlternative: `// Safe: Manual redirect handling
const res = await fetch(url, { redirect: 'manual', headers: { Authorization: token } });
if (res.status >= 300 && res.status < 400) {
  const location = res.headers.get('location');
  if (location && new URL(location).origin === new URL(url).origin) {
    return fetch(location, { headers: { Authorization: token } });
  }
  return fetch(location!); // no auth header for cross-origin
}`,
    references: ['https://github.com/advisories/GHSA-r683-j2x4-v87g'],
  },
  {
    cveId: 'CVE-2022-25883',
    packageName: 'semver',
    cweId: 'CWE-1333',
    dangerousPatterns: [
      /\bsemver\.(?:satisfies|valid|coerce|clean|gt|lt|gte|lte)\s*\(\s*(?:req\.|input|user|data|body|query|params|version)/i,
    ],
    description: 'semver is vulnerable to ReDoS via specially crafted version strings',
    descriptionKo: 'semver의 버전 문자열 파싱에서 ReDoS 공격이 가능합니다',
    codeRemediation: 'Upgrade semver >=7.5.2. Validate input length before parsing. Limit version strings to reasonable length.',
    codeRemediationKo: 'semver 7.5.2 이상으로 업그레이드하세요. 파싱 전 입력 길이를 검증하세요.',
    safeAlternative: `// Safe: Validate before parsing
if (versionStr.length > 50) throw new Error('Invalid version');
const valid = semver.valid(semver.coerce(versionStr));`,
    references: ['https://github.com/advisories/GHSA-c2qf-rxjj-qqgw'],
  },
  {
    cveId: 'CVE-2022-31129',
    packageName: 'moment',
    cweId: 'CWE-1333',
    dangerousPatterns: [
      /\bmoment\s*\(\s*(?:req\.|input|user|data|body|query|params|dateStr)/i,
    ],
    description: 'moment is vulnerable to ReDoS via specially crafted date strings in rfc2822 parsing',
    descriptionKo: 'moment의 날짜 파싱에서 특수하게 제작된 문자열로 ReDoS 공격이 가능합니다',
    codeRemediation: 'Upgrade moment >=2.29.4. Consider migrating to dayjs or date-fns (lighter, maintained). Validate date string format before parsing.',
    codeRemediationKo: 'moment 2.29.4 이상으로 업그레이드하세요. dayjs 또는 date-fns로 마이그레이션을 고려하세요. 파싱 전 날짜 형식을 검증하세요.',
    safeAlternative: `// Safe: Use dayjs (maintained, lighter)
import dayjs from 'dayjs';
const date = dayjs(validatedDateStr, 'YYYY-MM-DD', true);
if (!date.isValid()) throw new Error('Invalid date');`,
    references: ['https://github.com/advisories/GHSA-wc69-rhjr-hc9g'],
  },
  {
    cveId: 'CVE-2021-42740',
    packageName: 'shell-quote',
    cweId: 'CWE-78',
    dangerousPatterns: [
      /\bshellQuote\.parse\s*\(\s*(?:req\.|input|user|data|body|query|params|cmd|command)/i,
      /\bparse\s*\(\s*(?:req\.|input|user|cmd|command)/i,
    ],
    description: 'shell-quote parse() allows command injection via crafted input strings',
    descriptionKo: 'shell-quote의 parse()에서 특수하게 제작된 입력으로 명령 인젝션이 가능합니다',
    codeRemediation: 'Upgrade shell-quote >=1.7.3. Avoid parsing user input as shell commands. Use execFile() with argument arrays instead.',
    codeRemediationKo: 'shell-quote 1.7.3 이상으로 업그레이드하세요. 사용자 입력을 쉘 명령으로 파싱하지 마세요. execFile()과 인자 배열을 사용하세요.',
    safeAlternative: `// Safe: Use execFile with argument arrays
import { execFile } from 'child_process';
execFile('ls', ['-la', sanitizedPath], (err, stdout) => { ... });`,
    references: ['https://github.com/advisories/GHSA-g4rg-993r-mgx7'],
  },
  {
    cveId: 'CVE-2021-3807',
    packageName: 'ansi-regex',
    cweId: 'CWE-1333',
    dangerousPatterns: [
      /\bansiRegex\s*\(\s*\)\s*\.test\s*\(\s*(?:req\.|input|user|data|body)/i,
      /\bstripAnsi\s*\(\s*(?:req\.|input|user|data|body)/i,
    ],
    description: 'ansi-regex is vulnerable to ReDoS via crafted ANSI escape sequences',
    descriptionKo: 'ansi-regex에서 특수하게 제작된 ANSI 이스케이프 시퀀스로 ReDoS 공격이 가능합니다',
    codeRemediation: 'Upgrade ansi-regex >=6.0.1 or >=5.0.1. Limit input string length before processing.',
    codeRemediationKo: 'ansi-regex 6.0.1 이상으로 업그레이드하세요. 처리 전 입력 길이를 제한하세요.',
    safeAlternative: `// Safe: Limit input before strip
const MAX_LEN = 10000;
const safe = input.length > MAX_LEN ? input.slice(0, MAX_LEN) : input;
const stripped = stripAnsi(safe);`,
    references: ['https://github.com/advisories/GHSA-93q8-gq69-wqmw'],
  },
  {
    cveId: 'CVE-2022-33987',
    packageName: 'got',
    cweId: 'CWE-918',
    dangerousPatterns: [
      /\bgot\s*\(\s*(?:req\.|input|user|url|target|href|data|body)/i,
      /\bgot\.(?:get|post|put|delete)\s*\(\s*(?:req\.|input|user|url|target)/i,
    ],
    description: 'got follows redirects to Unix sockets, enabling SSRF attacks',
    descriptionKo: 'got이 Unix 소켓으로의 리다이렉트를 따라가 SSRF 공격이 가능합니다',
    codeRemediation: 'Upgrade got >=12.1.0. Use URL validation and allowlist for outgoing requests. Disable auto-redirect or validate redirect targets.',
    codeRemediationKo: 'got 12.1.0 이상으로 업그레이드하세요. URL 검증과 화이트리스트를 적용하세요. 자동 리다이렉트를 비활성화하거나 리다이렉트 대상을 검증하세요.',
    safeAlternative: `// Safe: Validate URL before request
const parsed = new URL(userUrl);
const allowed = ['api.example.com', 'cdn.example.com'];
if (!allowed.includes(parsed.hostname)) throw new Error('Forbidden host');
if (parsed.protocol !== 'https:') throw new Error('HTTPS only');
const res = await got(parsed.href, { followRedirect: false });`,
    references: ['https://github.com/advisories/GHSA-pfrx-2q88-qq97'],
  },
  {
    cveId: 'CVE-2021-44906',
    packageName: 'minimist',
    cweId: 'CWE-1321',
    dangerousPatterns: [
      /\bminimist\s*\(\s*(?:req\.|input|user|args|argv|process\.argv)/i,
      /\bparseArgs\s*\(\s*(?:req\.|input|user|args)/i,
    ],
    description: 'minimist allows prototype pollution via crafted command-line arguments',
    descriptionKo: 'minimist에서 특수하게 제작된 명령행 인자로 프로토타입 오염이 가능합니다',
    codeRemediation: 'Upgrade minimist >=1.2.6. Consider using commander, yargs, or Node.js built-in parseArgs instead.',
    codeRemediationKo: 'minimist 1.2.6 이상으로 업그레이드하세요. commander, yargs 또는 Node.js 내장 parseArgs 사용을 고려하세요.',
    safeAlternative: `// Safe: Use Node.js built-in parseArgs
import { parseArgs } from 'node:util';
const { values } = parseArgs({ args: process.argv.slice(2), options: { name: { type: 'string' } } });`,
    references: ['https://github.com/advisories/GHSA-xvch-5gv4-984h'],
  },
  {
    cveId: 'CVE-2023-26159',
    packageName: 'follow-redirects',
    cweId: 'CWE-601',
    dangerousPatterns: [
      /\bfollow-redirects\b/i,
      /\baxios\s*\(\s*\{[^}]*url\s*:\s*(?:req\.|input|user|data|body|query)/i,
    ],
    description: 'follow-redirects allows open redirect via crafted absolute URL in redirect response',
    descriptionKo: 'follow-redirects에서 리다이렉트 응답의 절대 URL을 통한 오픈 리다이렉트가 가능합니다',
    codeRemediation: 'Upgrade follow-redirects >=1.15.4. Validate all redirect URLs against an allowlist.',
    codeRemediationKo: 'follow-redirects 1.15.4 이상으로 업그레이드하세요. 모든 리다이렉트 URL을 화이트리스트로 검증하세요.',
    safeAlternative: `// Safe: Validate axios request URLs
const allowedHosts = ['api.myapp.com'];
const url = new URL(requestUrl);
if (!allowedHosts.includes(url.hostname)) throw new Error('Forbidden');`,
    references: ['https://github.com/advisories/GHSA-jchw-25xp-jwwc'],
  },
  {
    cveId: 'CVE-2024-28849',
    packageName: 'follow-redirects',
    cweId: 'CWE-200',
    dangerousPatterns: [
      /\baxios\s*\.\s*(?:get|post|put)\s*\([^)]*headers\s*:\s*\{[^}]*(?:Authorization|Cookie|Set-Cookie)/i,
    ],
    description: 'follow-redirects leaks Authorization header on cross-origin redirect',
    descriptionKo: 'follow-redirects에서 크로스 오리진 리다이렉트 시 Authorization 헤더가 유출됩니다',
    codeRemediation: 'Upgrade follow-redirects >=1.15.6. Strip sensitive headers manually on cross-origin redirect.',
    codeRemediationKo: 'follow-redirects 1.15.6 이상으로 업그레이드하세요. 크로스 오리진 리다이렉트 시 민감한 헤더를 수동으로 제거하세요.',
    safeAlternative: `// Safe: Use axios with beforeRedirect
const res = await axios.get(url, {
  beforeRedirect: (options) => {
    delete options.headers['Authorization'];
  }
});`,
    references: ['https://github.com/advisories/GHSA-cxjh-pqwp-8mfp'],
  },
  {
    cveId: 'CVE-2023-44270',
    packageName: 'postcss',
    cweId: 'CWE-74',
    dangerousPatterns: [
      /\bpostcss\s*\(\s*\[?\s*\]\s*\)\s*\.process\s*\(\s*(?:req\.|input|user|data|body)/i,
    ],
    description: 'PostCSS allows code injection via crafted external characters in CSS',
    descriptionKo: 'PostCSS에서 CSS의 외부 문자를 통한 코드 인젝션이 가능합니다',
    codeRemediation: 'Upgrade postcss >=8.4.31. Never process untrusted CSS input directly.',
    codeRemediationKo: 'postcss 8.4.31 이상으로 업그레이드하세요. 신뢰할 수 없는 CSS 입력을 직접 처리하지 마세요.',
    safeAlternative: `// Safe: Process only trusted CSS
import postcss from 'postcss';
const trustedCss = loadFromTrustedSource();
const result = await postcss([autoprefixer]).process(trustedCss, { from: undefined });`,
    references: ['https://github.com/advisories/GHSA-7fh5-64p2-3v2j'],
  },
  {
    cveId: 'CVE-2024-4068',
    packageName: 'braces',
    cweId: 'CWE-1333',
    dangerousPatterns: [
      /\bbraces\s*\(\s*(?:req\.|input|user|data|body|query|params)/i,
      /\bmicromatch\s*\(\s*\w+\s*,\s*(?:req\.|input|user|data|body)/i,
    ],
    description: 'braces (used by micromatch) is vulnerable to ReDoS via unbalanced braces',
    descriptionKo: 'braces(micromatch에서 사용)에서 불균형 중괄호를 통한 ReDoS 공격이 가능합니다',
    codeRemediation: 'Upgrade braces >=3.0.3. Validate and limit user-supplied glob patterns.',
    codeRemediationKo: 'braces 3.0.3 이상으로 업그레이드하세요. 사용자 제공 glob 패턴을 검증하고 제한하세요.',
    safeAlternative: `// Safe: Validate glob patterns
const MAX_PATTERN_LEN = 200;
if (pattern.length > MAX_PATTERN_LEN) throw new Error('Pattern too long');
if (/\\{.*\\{.*\\{.*\\{/.test(pattern)) throw new Error('Too many nested braces');`,
    references: ['https://github.com/advisories/GHSA-grv7-fg5c-xmjg'],
  },
  {
    cveId: 'CVE-2022-37601',
    packageName: 'loader-utils',
    cweId: 'CWE-1321',
    dangerousPatterns: [
      /\bgetHashDigest\s*\(\s*(?:req\.|input|user|data|body)/i,
      /\binterpolateName\s*\(\s*(?:req\.|input|user|data)/i,
    ],
    description: 'loader-utils is vulnerable to prototype pollution via parseQuery()',
    descriptionKo: 'loader-utils의 parseQuery()에서 프로토타입 오염 취약점이 있습니다',
    codeRemediation: 'Upgrade loader-utils >=2.0.4. Use schema validation for query parameters.',
    codeRemediationKo: 'loader-utils 2.0.4 이상으로 업그레이드하세요. 쿼리 파라미터에 스키마 검증을 적용하세요.',
    safeAlternative: `// Safe: Use validated options
const validated = schema.parse(loaderOptions);`,
    references: ['https://github.com/advisories/GHSA-76p3-8jx3-jpfq'],
  },
  {
    cveId: 'CVE-2021-3749',
    packageName: 'axios',
    cweId: 'CWE-400',
    dangerousPatterns: [
      /axios\.\w+\s*\(\s*(?:req\.|input|user|url|target)/i,
    ],
    description: 'axios is vulnerable to ReDoS via crafted trim() operation on large inputs',
    descriptionKo: 'axios에서 대용량 입력에 대한 trim() 연산으로 ReDoS 공격이 가능합니다',
    codeRemediation: 'Upgrade axios >=0.21.3. Validate input size before passing to axios.',
    codeRemediationKo: 'axios 0.21.3 이상으로 업그레이드하세요. axios에 전달하기 전 입력 크기를 검증하세요.',
    safeAlternative: `// Safe: Validate URL length
if (url.length > 2000) throw new Error('URL too long');
const res = await axios.get(url);`,
    references: ['https://github.com/advisories/GHSA-cph5-m8f7-6c5x'],
  },
];

export function getPatternsByCve(cveId: string): CveCodePattern | undefined {
  return CVE_CODE_PATTERNS.find((p) => p.cveId === cveId);
}

export function getPatternsByPackage(packageName: string): CveCodePattern[] {
  return CVE_CODE_PATTERNS.filter((p) => p.packageName === packageName);
}

export function getPatternsForCwe(cweId: string): CveCodePattern[] {
  return CVE_CODE_PATTERNS.filter((p) => p.cweId === cweId);
}

export function scanCodeForCvePatterns(
  code: string,
  patterns: CveCodePattern[],
): Array<{ cveId: string; line: number; matchedCode: string; pattern: CveCodePattern }> {
  const findings: Array<{ cveId: string; line: number; matchedCode: string; pattern: CveCodePattern }> = [];
  const lines = code.split('\n');

  for (const pattern of patterns) {
    for (let i = 0; i < lines.length; i++) {
      const line = lines[i];
      for (const regex of pattern.dangerousPatterns) {
        if (regex.test(line)) {
          findings.push({
            cveId: pattern.cveId,
            line: i + 1,
            matchedCode: line.trim(),
            pattern,
          });
          break;
        }
      }
    }
  }

  return findings;
}

export function getAllCvePatterns(): CveCodePattern[] {
  return [...CVE_CODE_PATTERNS];
}
